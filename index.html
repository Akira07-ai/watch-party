<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Watch Party</title>
    
    <!-- External Dependencies -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/simple-peer@9.11.0/simplepeer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.2/toastify.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.2/toastify.min.js"></script>

    <!-- Initialize Supabase -->
    <script>
        const supabaseUrl = 'https://pqqxlilkkqnhfsnixtwa.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcXhsaWxra3FuaGZzbml4dHdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzExNjI4MDYsImV4cCI6MjA0NjczODgwNn0.XAGbRLnbpfitg9QjGLNoee1fxp57Li4ExB4_BxwUvM4';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);
    </script>

    <style>
        /* Reset and Base Styles */
        :root {
            --primary-color: #ff0000;
            --background-color: #000000;
            --text-color: #ffffff;
            --accent-color: rgba(255, 0, 0, 0.5);
            --overlay-bg: rgba(0, 0, 0, 0.8);
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 10px;
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Initial Forms */
        .initial-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: var(--spacing-lg);
            background: var(--background-color);
        }

        .forms-wrapper {
            background: var(--overlay-bg);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 400px;
        }

        .button-group {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
        }

        .button-group button {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius-md);
            background: var(--primary-color);
            color: var(--text-color);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .button-group button:hover {
            transform: scale(1.05);
        }

        .form-slide {
            animation: slideIn 0.3s ease-out;
        }

        .animated-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .input-group input,
        .input-group select {
            padding: var(--spacing-sm);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-sm);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        /* Layout */
        .container {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: var(--spacing-lg);
            padding: var(--spacing-lg);
            height: 100vh;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Video Section Styles */
        .video-section {
            background: var(--overlay-bg);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .video-player {
            aspect-ratio: 16/9;
            background: #000;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            position: relative;
        }

        .video-player video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Playback Controls */
        .playback-controls {
            background: var(--overlay-bg);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .primary-controls,
        .secondary-controls,
        .volume-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-xs);
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: var(--accent-color);
            transform: scale(1.05);
        }

        /* Chat Section */
        .chat-section {
            background: var(--overlay-bg);
            border-radius: var(--border-radius-lg);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-tabs {
            display: flex;
            gap: 2px;
            padding: var(--spacing-sm) var(--spacing-sm) 0;
        }

        .chat-tabs button {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            cursor: pointer;
        }

        .chat-tabs button.active {
            background: var(--accent-color);
        }

        .chat-box {
            flex-grow: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        /* Messages */
        .message {
            max-width: 85%;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--spacing-md);
            word-break: break-word;
        }

        .message.sent {
            background: var(--accent-color);
            align-self: flex-end;
        }

        .message.received {
            background: rgba(255, 255, 255, 0.1);
            align-self: flex-start;
        }

        /* File Sharing */
        .files-box {
            display: none;
            height: 100%;
            padding: var(--spacing-md);
            overflow-y: auto;
        }

        .files-box.active {
            display: block;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            transition: all 0.3s;
        }

        .upload-area.drag-over {
            border-color: var(--primary-color);
            background: rgba(255, 0, 0, 0.1);
        }

        /* Reactions */
        .reaction-bar {
            display: flex;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin-top: var(--spacing-sm);
        }

        .reaction-btn {
            font-size: 20px;
            padding: var(--spacing-xs) var(--spacing-sm);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .reaction-btn:hover {
            transform: scale(1.2);
        }

        /* Animations */
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr 300px;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: var(--spacing-sm);
            }

            .chat-section {
                height: 400px;
            }

            .video-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
        }
    </style>
</head>
<body>
    <!-- Initial Forms Container -->
    <div id="initialForms" class="initial-container">
        <div class="forms-wrapper">
            <div id="initialButtons" class="button-group">
                <button onclick="showCreateRoomForm()">Create Room</button>
                <button onclick="showJoinRoomForm()">Join Room</button>
            </div>

            <!-- Create Room Form -->
            <div id="createRoomForm" class="form-slide" style="display: none;">
                <h3>Create New Room</h3>
                <form onsubmit="handleCreateRoom(event)" class="animated-form">
                    <div class="input-group">
                        <input type="text" id="newUserName" placeholder="Your Display Name" required>
                    </div>
                    <div class="input-group">
                        <input type="text" id="newMeetingName" placeholder="Meeting Name" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="newRoomPassword" placeholder="Room Password" required>
                    </div>
                    <button type="submit">Create Room</button>
                    <button type="button" onclick="showInitialButtons()" class="back-btn">Back</button>
                </form>
            </div>

            <!-- Join Room Form -->
            <div id="joinRoomForm" class="form-slide" style="display: none;">
                <h3>Join Existing Room</h3>
                <form onsubmit="handleJoinRoom(event)" class="animated-form">
                    <div class="input-group">
                        <input type="text" id="userName" placeholder="Your Display Name" required>
                    </div>
                    <div class="input-group">
                        <input type="text" id="meetingName" placeholder="Meeting Name" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="roomPassword" placeholder="Room Password" required>
                    </div>
                    <button type="submit">Join Room</button>
                    <button type="button" onclick="showInitialButtons()" class="back-btn">Back</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" style="display: none;">
        <!-- User Section -->
        <div class="user-section">
            <h3>Users in Room</h3>
            <div id="userList" class="user-list"></div>
            
            <!-- Video Chat Grid -->
            <div id="videoGrid" class="video-grid"></div>
            
            <div id="adminControls" class="admin-controls" style="display: none;">
                <h4>Admin Controls</h4>
                <button onclick="toggleRoomSettings()">Room Settings</button>
                <button onclick="toggleAnalytics()">View Analytics</button>
            </div>
        </div>

        <!-- Video Section -->
        <div class="video-section">
            <!-- Theme Selector -->
            <div class="theme-selector">
                <select onchange="applyTheme(this.value)">
                    <option value="default">Default Theme</option>
                    <option value="light">Light Theme</option>
                    <option value="neon">Neon Theme</option>
                </select>
            </div>

            <div class="screen-share-controls">
                <button id="startScreenShare" onclick="startScreenShare()" class="control-btn">
                    <i class="fas fa-desktop"></i> Share Screen
                </button>
                <button id="stopScreenShare" onclick="stopScreenShare()" class="control-btn" style="display: none;">
                    <i class="fas fa-stop"></i> Stop Sharing
                </button>
                <button onclick="togglePiP()" class="control-btn">
                    <i class="fas fa-external-link-alt"></i> Picture-in-Picture
                </button>
            </div>

            <div id="videoPlayer" class="video-player">
                <!-- Video content will be added here -->
            </div>

            <!-- Enhanced Playback Controls -->
            <div class="playback-controls">
                <div class="primary-controls">
                    <button onclick="syncPlay()" class="control-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button onclick="syncPause()" class="control-btn">
                        <i class="fas fa-pause"></i>
                    </button>
                    <input type="range" id="timelineSlider" min="0" max="100" value="0">
                    <span id="currentTime">00:00</span> / <span id="duration">00:00</span>
                </div>
                
                <div class="secondary-controls">
                    <button onclick="syncSeekBackward()" class="control-btn">
                        <i class="fas fa-backward"></i> 10s
                    </button>
                    <select onchange="videoControls.setPlaybackSpeed(this.value)">
                        <option value="0.5">0.5x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                    <button onclick="syncSeekForward()" class="control-btn">
                        10s <i class="fas fa-forward"></i>
                    </button>
                    <button onclick="videoControls.takeSnapshot()" class="control-btn">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>

                <div class="volume-controls">
                    <i class="fas fa-volume-up"></i>
                    <input type="range" 
                           onchange="videoControls.setVolume(this.value)" 
                           min="0" max="1" step="0.1" value="1">
                    <button onclick="videoControls.toggleMute()" class="control-btn">
                        <i class="fas fa-volume-mute"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="chat-section">
            <div class="chat-tabs">
                <button class="active">Chat</button>
                <button>Files</button>
            </div>
            <div class="chat-box">
                <!-- Chat messages will be added here -->
            </div>
            <div class="files-box">
                <!-- Files will be added here -->
            </div>
        </div>
    </div>

    <!-- Main JavaScript -->
    <script>
        // Global Variables
        let roomId;
        let userName;
        let isAdmin = false;
        let peerConnections = {};
        let screenStream = null;
        let videoElement = null;
        let isScreenSharing = false;
        let currentTheme = 'default';
        let chatChannel;
        let videoStateChannel;

        // Theme Configuration
        const themes = {
            default: {
                primary: '#ff0000',
                background: '#000000',
                text: '#ffffff'
            },
            light: {
                primary: '#ff4444',
                background: '#ffffff',
                text: '#000000'
            },
            neon: {
                primary: '#00ff00',
                background: '#111111',
                text: '#00ff00'
            }
        };

        // Initialize App
        async function initializeApp() {
            try {
                videoElement = document.createElement('video');
                videoElement.id = 'mainVideo';
                document.getElementById('videoPlayer').appendChild(videoElement);
                
                setupVideoEventListeners();
                await initializeSupabase();
                setupEventListeners();
                initializeEmojiPicker();
                
                console.log('App initialized successfully');
            } catch (error) {
                showError('Initialization failed: ' + error.message);
            }
        }

        // Supabase Initialization
        async function initializeSupabase() {
            try {
                // Set up real-time subscriptions
                chatChannel = supabase
                    .channel('chat')
                    .on('broadcast', { event: 'message' }, handleNewMessage)
                    .subscribe();

                videoStateChannel = supabase
                    .channel('video_state')
                    .on('broadcast', { event: 'state_change' }, handleVideoStateChange)
                    .subscribe();

                console.log('Supabase channels initialized');
            } catch (error) {
                console.error('Supabase initialization failed:', error);
                throw error;
            }
        }

        // Event Listeners Setup
        function setupVideoEventListeners() {
            videoElement.addEventListener('loadedmetadata', () => {
                document.getElementById('duration').textContent = formatTime(videoElement.duration);
                document.querySelector('.playback-controls').style.display = 'flex';
            });

            videoElement.addEventListener('timeupdate', () => {
                document.getElementById('currentTime').textContent = formatTime(videoElement.currentTime);
                document.getElementById('timelineSlider').value = 
                    (videoElement.currentTime / videoElement.duration) * 100;
            });

            document.getElementById('timelineSlider').addEventListener('input', (e) => {
                const time = (videoElement.duration * e.target.value) / 100;
                videoElement.currentTime = time;
                broadcastVideoState('seek', time);
            });
        }

        // Room Management
        async function handleCreateRoom(event) {
            event.preventDefault();
            try {
                userName = document.getElementById('newUserName').value;
                const roomName = document.getElementById('newMeetingName').value;
                const password = document.getElementById('newRoomPassword').value;

                const { data, error } = await supabase
                    .from('rooms')
                    .insert([{
                        name: roomName,
                        password: password,
                        admin_name: userName,
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();

                if (error) throw error;

                roomId = data.id;
                isAdmin = true;
                enterRoom();
            } catch (error) {
                showError('Failed to create room: ' + error.message);
            }
        }

        async function handleJoinRoom(event) {
            event.preventDefault();
            try {
                userName = document.getElementById('userName').value;
                const roomName = document.getElementById('meetingName').value;
                const password = document.getElementById('roomPassword').value;

                const { data, error } = await supabase
                    .from('rooms')
                    .select()
                    .eq('name', roomName)
                    .eq('password', password)
                    .single();

                if (error) throw new Error('Invalid room name or password');

                roomId = data.id;
                isAdmin = data.admin_name === userName;
                enterRoom();
            } catch (error) {
                showError('Failed to join room: ' + error.message);
            }
        }

        // Video Controls
        const videoControls = {
            setPlaybackSpeed(speed) {
                if (!videoElement) return;
                videoElement.playbackRate = parseFloat(speed);
                broadcastVideoState('speed', speed);
            },
            
            setVolume(volume) {
                if (!videoElement) return;
                videoElement.volume = parseFloat(volume);
            },
            
            toggleMute() {
                if (!videoElement) return;
                videoElement.muted = !videoElement.muted;
            },
            
            takeSnapshot() {
                if (!videoElement) return;
                const canvas = document.createElement('canvas');
                canvas.width = videoElement.videoWidth;
                canvas.height = videoElement.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(videoElement, 0, 0);
                
                const link = document.createElement('a');
                link.download = 'snapshot.png';
                link.href = canvas.toDataURL();
                link.click();
            }
        };

        // Video State Management
        async function broadcastVideoState(action, value = null) {
            try {
                await videoStateChannel.send({
                    type: 'broadcast',
                    event: 'state_change',
                    payload: {
                        action,
                        value,
                        sender: userName
                    }
                });
            } catch (error) {
                console.error('Failed to broadcast video state:', error);
            }
        }

        function handleVideoStateChange(payload) {
            const { action, value, sender } = payload;
            if (sender === userName) return;

            switch (action) {
                case 'play':
                    videoElement?.play();
                    break;
                case 'pause':
                    videoElement?.pause();
                    break;
                case 'seek':
                    if (videoElement && value !== null) {
                        videoElement.currentTime = value;
                    }
                    break;
                case 'speed':
                    if (videoElement && value !== null) {
                        videoElement.playbackRate = value;
                    }
                    break;
            }
        }

        // Screen Sharing
        async function startScreenShare() {
            try {
                screenStream = await navigator.mediaDevices.getDisplayMedia({
                    video: true,
                    audio: true
                });
                videoElement.srcObject = screenStream;
                document.getElementById('startScreenShare').style.display = 'none';
                document.getElementById('stopScreenShare').style.display = 'block';
                isScreenSharing = true;
            } catch (error) {
                showError('Failed to start screen sharing: ' + error.message);
            }
        }

        function stopScreenShare() {
            if (screenStream) {
                screenStream.getTracks().forEach(track => track.stop());
                screenStream = null;
                videoElement.srcObject = null;
                document.getElementById('startScreenShare').style.display = 'block';
                document.getElementById('stopScreenShare').style.display = 'none';
                isScreenSharing = false;
            }
        }

        // Chat and File Sharing Functions
        async function sendMessage(content = null, type = 'text') {
            try {
                const messageContent = content || document.getElementById('messageInput').value.trim();
                if (!messageContent) return;

                await chatChannel.send({
                    type: 'broadcast',
                    event: 'message',
                    payload: {
                        type,
                        content: messageContent,
                        sender: userName,
                        timestamp: new Date().toISOString()
                    }
                });

                if (type === 'text') {
                    document.getElementById('messageInput').value = '';
                }
            } catch (error) {
                showError('Failed to send message: ' + error.message);
            }
        }

        function handleNewMessage(payload) {
            const { type, content, sender, timestamp } = payload;
            const chatBox = document.getElementById('chatBox');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === userName ? 'sent' : 'received'}`;

            switch (type) {
                case 'text':
                    messageDiv.innerHTML = `
                        <span class="sender">${sender}</span>
                        <span class="content">${escapeHtml(content)}</span>
                        <span class="timestamp">${formatTimestamp(timestamp)}</span>
                    `;
                    break;
                case 'file':
                    messageDiv.innerHTML = `
                        <span class="sender">${sender}</span>
                        <a href="${content.url}" target="_blank" class="file-link">
                            📎 ${escapeHtml(content.name)} (${formatFileSize(content.size)})
                        </a>
                        <span class="timestamp">${formatTimestamp(timestamp)}</span>
                    `;
                    break;
                case 'reaction':
                    messageDiv.innerHTML = `
                        <span class="reaction-message">
                            ${sender} reacted with ${content}
                        </span>
                    `;
                    break;
            }

            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // File Handling
        async function handleFileShare(event) {
            const files = event.target.files || event.dataTransfer.files;
            for (const file of files) {
                try {
                    const { data, error } = await supabase.storage
                        .from('shared-files')
                        .upload(`${roomId}/${file.name}`, file);

                    if (error) throw error;

                    const { data: { publicUrl } } = supabase.storage
                        .from('shared-files')
                        .getPublicUrl(`${roomId}/${file.name}`);

                    await sendMessage({
                        url: publicUrl,
                        name: file.name,
                        size: file.size
                    }, 'file');

                } catch (error) {
                    showError(`Failed to upload ${file.name}: ${error.message}`);
                }
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            handleFileShare(event);
        }

        // Room Settings and Analytics
        async function updateRoomSettings(settings) {
            try {
                const { error } = await supabase
                    .from('rooms')
                    .update(settings)
                    .eq('id', roomId);

                if (error) throw error;
                showSuccess('Room settings updated successfully');
            } catch (error) {
                showError('Failed to update room settings: ' + error.message);
            }
        }

        async function loadAnalytics() {
            try {
                const { data, error } = await supabase
                    .from('room_analytics')
                    .select('*')
                    .eq('room_id', roomId);

                if (error) throw error;

                const analyticsContent = document.getElementById('analyticsContent');
                analyticsContent.innerHTML = generateAnalyticsHTML(data);
            } catch (error) {
                showError('Failed to load analytics: ' + error.message);
            }
        }

        // Utility Functions
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            seconds = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function formatTimestamp(timestamp) {
            return new Date(timestamp).toLocaleTimeString();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function showError(message) {
            Toastify({
                text: message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "right",
                backgroundColor: "#ff4444",
            }).showToast();
        }

        function showSuccess(message) {
            Toastify({
                text: message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "right",
                backgroundColor: "#44ff44",
            }).showToast();
        }

        // Theme Management
        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;

            document.documentElement.style.setProperty('--primary-color', theme.primary);
            document.documentElement.style.setProperty('--background-color', theme.background);
            document.documentElement.style.setProperty('--text-color', theme.text);
            currentTheme = themeName;
        }

        // UI State Management
        function showCreateRoomForm() {
            document.getElementById('initialButtons').style.display = 'none';
            document.getElementById('createRoomForm').style.display = 'block';
        }

        function showJoinRoomForm() {
            document.getElementById('initialButtons').style.display = 'none';
            document.getElementById('joinRoomForm').style.display = 'block';
        }

        function showInitialButtons() {
            document.getElementById('initialButtons').style.display = 'flex';
            document.getElementById('createRoomForm').style.display = 'none';
            document.getElementById('joinRoomForm').style.display = 'none';
        }

        function enterRoom() {
            document.getElementById('initialForms').style.display = 'none';
            document.querySelector('.container').style.display = 'grid';
            if (isAdmin) {
                document.getElementById('adminControls').style.display = 'block';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
