<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Watch Party</title>
    
    <!-- Inline CSS -->
    <style>
        /* Base styles */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(
                135deg,
                #000000 0%,
                #1a0000 25%,
                #330000 50%,
                #800000 75%,
                #ff0000 100%
            );
            background-attachment: fixed;
            color: #fff;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Character Images */
        .character-images {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .character {
            position: absolute;
            opacity: 0.4;
            transition: opacity 0.3s ease;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.3));
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        .jinx {
            right: -100px;
            bottom: -50px;
            width: 500px;
            transform: rotate(-5deg);
            animation: float 6s ease-in-out infinite;
        }

        .vi {
            left: -50px;
            top: -50px;
            width: 400px;
            transform: rotate(5deg);
            animation: float 8s ease-in-out infinite;
        }

        .caitlyn {
            right: -50px;
            top: -50px;
            width: 400px;
            transform: rotate(-5deg);
            animation: float 7s ease-in-out infinite;
        }

        .silco {
            left: -100px;
            bottom: -50px;
            width: 500px;
            transform: rotate(5deg);
            animation: float 9s ease-in-out infinite;
        }

        /* Login Container */
        .login-container {
            position: relative;
            z-index: 2;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-form {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
            width: 300px;
            text-align: center;
        }

        .login-form h2 {
            margin: 0 0 20px;
            color: #ff0000;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        /* Form Elements */
        input {
            width: calc(100% - 22px);
            padding: 10px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            font-size: 16px;
        }

        input:focus {
            outline: none;
            border-color: #ff0000;
            box-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
        }

        .password-container {
            position: relative;
            width: 100%;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            width: auto;
        }

        button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: linear-gradient(45deg, #600 0%, #f00 100%);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease;
            font-size: 16px;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        /* Create Room Form */
        .create-room-form {
            display: none;
        }

        /* Main Container */
        .container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
            position: relative;
            z-index: 2;
        }

        /* Video Section */
        .video-section {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
        }

        .video-player {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 5px;
            overflow: hidden;
        }

        .video-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .video-controls input {
            flex-grow: 1;
            margin: 0;
        }

        .video-controls button {
            width: auto;
            margin: 0;
            padding: 10px 20px;
        }

        /* Admin Controls */
        .admin-controls {
            background: rgba(255, 0, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .admin-controls h3 {
            margin: 0 0 10px;
            color: #ff0000;
        }

        .user-list {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            margin: 5px 0;
            border-radius: 3px;
        }

        /* Chat Video Section */
        .chat-video-section {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
        }

        .video-feeds {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .video-feed {
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 5px;
            overflow: hidden;
        }

        .chat-box {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            max-height: 400px;
        }

        .message {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            word-wrap: break-word;
        }

        .message.sent {
            background: rgba(255, 0, 0, 0.2);
            margin-left: 20%;
            border-radius: 10px 10px 0 10px;
        }

        .message.received {
            background: rgba(255, 255, 255, 0.1);
            margin-right: 20%;
            border-radius: 10px 10px 10px 0;
        }

        .message strong {
            color: #ff0000;
            font-size: 0.9em;
        }

        /* Message Input Area */
        .message-input {
            display: flex;
            gap: 10px;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
        }

        .emoji-picker-btn, .file-upload-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            width: auto;
            font-size: 20px;
        }

        .message-input input {
            margin: 0;
            flex-grow: 1;
        }

        .message-input button {
            width: auto;
            margin: 0;
            padding: 10px 20px;
        }

        /* File Upload Styles */
        .chat-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .chat-image:hover {
            transform: scale(1.05);
        }

        .chat-video {
            max-width: 200px;
            border-radius: 5px;
        }

        .file-link {
            display: inline-block;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            color: white;
            text-decoration: none;
            transition: background 0.3s ease;
        }

        .file-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Upload Progress */
        .upload-progress {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin: 5px 0;
        }

        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #600 0%, #f00 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Emoji Picker */
        .emoji-picker {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 5px;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin-bottom: 10px;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }

        .emoji-picker span {
            cursor: pointer;
            padding: 5px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .emoji-picker span:hover {
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <div class="character-images">
        <img src="jinx.png" alt="" class="character jinx">
        <img src="vi.jpg" alt="" class="character vi">
        <img src="caitlyn.jpg" alt="" class="character caitlyn">
        <img src="silco.webp" alt="" class="character silco">
    </div>

    <div class="login-container" id="loginContainer">
        <div class="login-form">
            <h2>Arcane Watch Party</h2>
            
            <!-- Join Room Form -->
            <div id="joinRoomForm">
                <h3>Join Room</h3>
                <input type="text" id="userName" placeholder="Your Display Name" required>
                <input type="text" id="meetingName" placeholder="Meeting Name" required>
                <div class="password-container">
                    <input type="password" id="roomPassword" placeholder="Room Password" required>
                    <button class="password-toggle" onclick="togglePassword('roomPassword')">👁️</button>
                </div>
                <button onclick="joinRoom()">Join Room</button>
                <button onclick="showCreateRoom()">Create New Room</button>
            </div>

            <!-- Create Room Form -->
            <div id="createRoomForm" class="create-room-form">
                <h3>Create Room</h3>
                <input type="text" id="newUserName" placeholder="Your Display Name" required>
                <input type="text" id="newMeetingName" placeholder="Set Meeting Name" required>
                <div class="password-container">
                    <input type="password" id="newRoomPassword" placeholder="Set Room Password" required>
                    <button class="password-toggle" onclick="togglePassword('newRoomPassword')">👁️</button>
                </div>
                <button onclick="createRoom()">Create Room</button>
                <button onclick="showJoinRoom()">Back to Join</button>
            </div>
        </div>
    </div>

    <div class="container" style="display: none;">
        <div class="video-section">
            <div class="video-player" id="videoPlayer"></div>
            <div class="video-controls">
                <input type="text" id="videoUrl" placeholder="Paste video URL">
                <button onclick="shareVideo()">Share Video</button>
            </div>
            <div class="admin-controls" id="adminControls" style="display: none;">
                <h3>Room Controls</h3>
                <button onclick="kickUser()">Kick User</button>
                <button onclick="muteAll()">Mute All</button>
                <button onclick="lockRoom()">Lock Room</button>
                <div class="user-list" id="userList"></div>
            </div>
        </div>

        <div class="chat-video-section">
            <div class="video-feeds">
                <div class="video-feed" id="localVideo"></div>
                <div class="video-feed" id="remoteVideos"></div>
            </div>
            <div class="chat-box" id="chatBox"></div>
            <div class="message-input">
                <button class="emoji-picker-btn" onclick="toggleEmojiPicker()">😊</button>
                <input type="text" id="messageInput" placeholder="Type a message...">
                <label for="fileInput" class="file-upload-btn">📎</label>
                <input type="file" id="fileInput" style="display: none" onchange="handleFileUpload(event)">
                <button onclick="sendMessage()">Send</button>
            </div>
            <div class="emoji-picker" id="emojiPicker" style="display: none"></div>
        </div>
    </div>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>

    <!-- WebRTC adapter -->
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>

    <!-- Inline JavaScript -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {

            apiKey: "AIzaSyBT6qPRvbKJmOOPaFOrQTsQaQU0DYsOvZA",
          
            authDomain: "watch-party-89042.firebaseapp.com",
          
            databaseURL: "https://watch-party-89042-default-rtdb.asia-southeast1.firebasedatabase.app",
          
            projectId: "watch-party-89042",
          
            storageBucket: "watch-party-89042.firebasestorage.app",
          
            messagingSenderId: "801694983399",
          
            appId: "1:801694983399:web:32ac147c52f19e4bd56e42",
          
            measurementId: "G-2VB13DYW85"
          
          };
          

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Global variables
        let userName = '';
        let roomName = '';
        let isAdmin = false;

        // UI Functions
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function showCreateRoom() {
            document.getElementById('joinRoomForm').style.display = 'none';
            document.getElementById('createRoomForm').style.display = 'block';
        }

        function showJoinRoom() {
            document.getElementById('createRoomForm').style.display = 'none';
            document.getElementById('joinRoomForm').style.display = 'block';
        }

        // Room Functions
        async function createRoom() {
            const newUserName = document.getElementById('newUserName').value;
            const newMeetingName = document.getElementById('newMeetingName').value;
            const newRoomPassword = document.getElementById('newRoomPassword').value;

            if (!newUserName || !newMeetingName || !newRoomPassword) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const roomRef = database.ref(`rooms/${newMeetingName}`);
                const snapshot = await roomRef.once('value');
                
                if (snapshot.exists()) {
                    alert('Room already exists. Please choose a different name.');
                    return;
                }

                await roomRef.set({
                    password: newRoomPassword,
                    admin: newUserName,
                    created: Date.now()
                });

                userName = newUserName;
                roomName = newMeetingName;
                isAdmin = true;

                enterRoom();

            } catch (error) {
                console.error('Error creating room:', error);
                alert('Failed to create room');
            }
        }

        async function joinRoom() {
            const userNameInput = document.getElementById('userName').value;
            const meetingNameInput = document.getElementById('meetingName').value;
            const roomPasswordInput = document.getElementById('roomPassword').value;

            if (!userNameInput || !meetingNameInput || !roomPasswordInput) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const roomRef = database.ref(`rooms/${meetingNameInput}`);
                const snapshot = await roomRef.once('value');
                
                if (!snapshot.exists()) {
                    alert('Room does not exist');
                    return;
                }

                const roomData = snapshot.val();
                if (roomData.password !== roomPasswordInput) {
                    alert('Incorrect password');
                    return;
                }

                userName = userNameInput;
                roomName = meetingNameInput;
                isAdmin = roomData.admin === userNameInput;

                enterRoom();

            } catch (error) {
                console.error('Error joining room:', error);
                alert('Failed to join room');
            }
        }

        function enterRoom() {
            document.getElementById('loginContainer').style.display = 'none';
            document.querySelector('.container').style.display = 'grid';
            
            if (isAdmin) {
                document.getElementById('adminControls').style.display = 'block';
            }

            initializeChat();
            initializeVideoChat();
            updateUserList();
        }

        // Chat Functions
        function initializeChat() {
            const chatRef = database.ref(`rooms/${roomName}/chat`);
            const chatBox = document.getElementById('chatBox');
            const messageInput = document.getElementById('messageInput');

            chatRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                displayMessage(message);
            });

            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Initialize emoji picker
            initializeEmojiPicker();
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message) {
                const chatRef = database.ref(`rooms/${roomName}/chat`);
                chatRef.push({
                    sender: userName,
                    message: message,
                    timestamp: Date.now(),
                    type: 'text'
                });
                messageInput.value = '';
            }
        }

        function displayMessage(message) {
            const chatBox = document.getElementById('chatBox');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(message.sender === userName ? 'sent' : 'received');

            if (message.type === 'file') {
                if (message.fileType.startsWith('image/')) {
                    messageElement.innerHTML = `
                        <strong>${message.sender}</strong><br>
                        <img src="${message.message}" alt="${message.fileName}" class="chat-image"><br>
                        <small>${message.fileName}</small>
                    `;
                } else {
                    messageElement.innerHTML = `
                        <strong>${message.sender}</strong><br>
                        <a href="${message.message}" target="_blank" class="file-link">
                            📎 ${message.fileName}
                        </a>
                    `;
                }
            } else {
                messageElement.innerHTML = `
                    <strong>${message.sender}</strong><br>
                    ${message.message}
                `;
            }

            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // File Upload Functions
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Size validation (10MB limit)
            if (file.size > 10 * 1024 * 1024) {
                alert('File too large. Please choose a file under 10MB.');
                return;
            }

            // Create progress element
            const progressElement = document.createElement('div');
            progressElement.innerHTML = `
                <div>Uploading ${file.name}...</div>
                <div class="upload-progress">
                    <div class="upload-progress-bar" style="width: 0%"></div>
                </div>
            `;
            document.getElementById('chatBox').appendChild(progressElement);

            try {
                const fileRef = storage.ref(`rooms/${roomName}/files/${Date.now()}_${file.name}`);
                
                // Upload with progress tracking
                const uploadTask = fileRef.put(file);
                
                uploadTask.on('state_changed', 
                    (snapshot) => {
                        // Update progress bar
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        progressElement.querySelector('.upload-progress-bar').style.width = progress + '%';
                    },
                    (error) => {
                        console.error('Upload failed:', error);
                        progressElement.innerHTML = 'Upload failed';
                        setTimeout(() => progressElement.remove(), 3000);
                    },
                    async () => {
                        // Upload completed
                        const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                        progressElement.remove();

                        // Send message to chat
                        const chatRef = database.ref(`rooms/${roomName}/chat`);
                        chatRef.push({
                            sender: userName,
                            message: downloadURL,
                            fileName: file.name,
                            fileType: file.type,
                            timestamp: Date.now(),
                            type: 'file'
                        });
                    }
                );
            } catch (error) {
                console.error('Error starting upload:', error);
                progressElement.innerHTML = 'Upload failed';
                setTimeout(() => progressElement.remove(), 3000);
            }
        }

        // Video Functions
        function shareVideo() {
            const videoUrl = document.getElementById('videoUrl').value.trim();
            
            if (!videoUrl) {
                alert('Please enter a valid video URL');
                return;
            }

            const videoRef = database.ref(`rooms/${roomName}/video`);
            videoRef.set({
                url: videoUrl,
                sharedBy: userName,
                timestamp: Date.now()
            });

            loadVideo(videoUrl);
        }

        function loadVideo(url) {
            const videoPlayer = document.getElementById('videoPlayer');
            
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const videoId = extractYouTubeId(url);
                videoPlayer.innerHTML = `
                    <iframe 
                        width="100%" 
                        height="100%" 
                        src="https://www.youtube.com/embed/${videoId}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>`;
            } else {
                videoPlayer.innerHTML = `
                    <video id="sharedVideo" controls style="width: 100%; height: 100%;">
                        <source src="${url}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>`;
            }
        }

        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // Admin Functions
        function updateUserList() {
            if (!isAdmin) return;
            
            const userListRef = database.ref(`rooms/${roomName}/users`);
            userListRef.on('value', (snapshot) => {
                const users = snapshot.val() || {};
                const userList = document.getElementById('userList');
                userList.innerHTML = '';
                
                Object.entries(users).forEach(([userId, userData]) => {
                    const userElement = document.createElement('div');
                    userElement.className = 'user-item';
                    userElement.innerHTML = `
                        <span>${userData.name}</span>
                        <button onclick="kickUserById('${userId}')">Kick</button>
                    `;
                    userList.appendChild(userElement);
                });
            });
        }

        function kickUser() {
            if (!isAdmin) return;
            const userId = prompt('Enter user ID to kick:');
            if (userId) {
                kickUserById(userId);
            }
        }

        function kickUserById(userId) {
            if (!isAdmin) return;
            const userRef = database.ref(`rooms/${roomName}/users/${userId}`);
            userRef.remove();
        }

        function muteAll() {
            if (!isAdmin) return;
            const videoRef = database.ref(`rooms/${roomName}/settings/muteAll`);
            videoRef.set(true);
        }

        function lockRoom() {
            if (!isAdmin) return;
            const roomRef = database.ref(`rooms/${roomName}/settings/locked`);
            roomRef.set(true);
        }

        // Emoji Picker
        function initializeEmojiPicker() {
            const emojis = ['😊', '😂', '❤️', '👍', '😎', '🎮', '🎥', '💬', '🔥', '✨', '🎵', '🎬', '👋', '🤔', '😅', '🙌'];
            const picker = document.getElementById('emojiPicker');
            
            emojis.forEach(emoji => {
                const span = document.createElement('span');
                span.textContent = emoji;
                span.onclick = () => addEmoji(emoji);
                picker.appendChild(span);
            });
        }

        function toggleEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            picker.style.display = picker.style.display === 'none' ? 'grid' : 'none';
        }

        function addEmoji(emoji) {
            const messageInput = document.getElementById('messageInput');
            messageInput.value += emoji;
            messageInput.focus();
        }

        // Initialize when page loads
        window.onload = function() {
            initializeEmojiPicker();
        };
    </script>
</body>
</html>
